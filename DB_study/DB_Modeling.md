# 데이터베이스 모델링
- 데이터베이스 시스템을 구축하기 위해 데이터의 구조와 관계, 제약 조건 등을 설계하여 효율적이고 일관성 있는 데이터베이스를 만들기 위한 과정
- 모델링을 통해 성능, 무결성, 신뢰성을 보장할 수 있음

## 데이터베이스 모델링의 중요성
- 효율성
  - 데이터베이스 구조를 잘 설계하면 쿼리 성능과 저장 효율이 향상
- 일관성
  - 중복과 이상 현상을 최소화하여, 데이터가 서로 모순되거나 충돌하지 않도록 함
- 무결성 보장
  - 무결성 제약 조건을 모델링 단계에서 설정해두어, 부적절한 데이터를 방지

## 무결성 제약 조건
### 무결성
- 데이터베이스가 잘못 된 데이터의 삽입, 수정, 삭제로부터 보호되어 **데이터의 일관성과 신뢰성**을 유지하는 것

### 1. 개체 무결성 (Entity Integrity)
- **기본키 (PK)**가 유일(중복 불가) 하고 'NULL'값을 허용하지 않는 제약
- 핵심 원칙
  1. 각 레코드는 유일한 식별자를 가져야함 (PK 중복 불가)
  2. 기본키는 NULL 값을 가질 수 없음 (필수값)

### 2. 참조 무결성 (Referential Integrity)
- **외래키 (FK)** 와 관련된 제약으로, 존재하지 않는 기본키를 참조하지 못하도록 하는 규칙
- 핵심 원칙
  1. 외래키는 참조 대상 테이블의 기본키 값을 참조하거나 'NULL' 값을 가질 수 있음
  2. 참조 대상 테이블에 존재하지 않는 기본키 값은 사용할 수 없음
  3. 외래키로 연결된 레코드를 삭제, 수정 할 때 연쇄 작업(ON DELETE CASCADE 등)또는 예외 처리를 통해 무결성 유지

### 3. 도메인 무결성 (Domain Integrity)
- 각 속성(컬럼)이 정의된 도메인(값의 범위, 형식)을 벗어나지 않도록 하는 제약
- 핵심 원칙
  1. 속성별로 데이터 타입, 길이, 범위 등을 정의해야 함
  2. 값이 해당 범위(도메인)를 벗어나면 삽임, 수정이 제한되거나 오류 발생

### 그 외 무결성 제약 조건
1. 고유성 (UNIQUE)
  - 특정 컬럼의 값이 테이블 내에 중복되지 않도록 제한 (이메일, id 등)
2. NULL 무결성 (NOT NULL)
  - 특정 컬럼이 NULL 값을 가질 수 없도록 하는 제약
3. 일반 무결성 (General Integrity)
  - 비즈니스 로직에 따라 추가로 정의하는 무결성 원칙


## 모델링 과정 4단계
**요구사항 수집 및 분석 -> 개념적 설계 -> 논리적 설계 -> 물리적 설계**

### 1. 요구사항 수집 및 분석
- 어떤 종류의 데이터를 정리하는지 정보 수집하고 어떤 작업을 수행해야 하는지 파악하는 단계
  - 개체 (Entity)
    -  업무에 필요하고 유용한 정보를 저장하는 집합적인 것
 -  속성 (Attribute)
    -  관리하고자 하는 것의 의미를 더 이상 작은 단위로 분리되지 않는 데이터 단위
 -  관계 (Relationship)
    -  개체 사이의 논리적인 연관성을 의미하는 것

### 2. 개념적 설계
- 요구사항을 기반으로 데이터베이스의 **개념적 모델**을 설계
- 개체와 관계를 식별하고, 개체간의 관계를 정의하며 ER Diagram을 작성

### 3. 논리적 설계
- 개념적 설계를 기반으로 데이터베이스의 **논리적 모델**을 설계
- 테이블, 칼럼(속성), 제약 조건 등과 같은 구체적인 데이터베이스 개체를 정의
- 정규화를 수행하여 데이터 중복을 최소화하고 일관성을 유지

### 4. 물리적 설계
- 논리적 설계를 기반으로 데이터베이스를 실제 **저장 및 운영** 할 수 있는 형태로 변환하는 단계
- 테이블의 인덱스, 파티션, 클러스터링 등 물리적인 구조와 접근 방식을 결정
- 보안, 백업 및 복구, 성능 최적화 등을 고려하여 데이터베이스를 설정

# 데이터베이스 정규화
## 정규화 (Normalization)
- **데이터 중복을 최소화**하고, **이상 현상을 예방**하며, 데이터베이스 구조 변경 시 재작업을 줄이는 목적으로 **테이블을 구조화**하는 과정

### 정규화 목적
1. 중복 최소화
  - 불필요한 중복 데이터를 제거해 일관성을 유지 
2. 이상 현상 방지
  - 삽입, 갱신, 삭제 작업 시 발생할 수 있는 불일치 문제 예방
3. 유연성 향상
  - 데이터베이스 구조 변경 시 영향을 받는 영역을 최소화하여 유지보수성을 높임

## 이상 현상 (Anomaly)
- 데이터베이스를 비정상적으로 설계 했을 때 중복된 데이터가 많아져 삽입, 갱신, 삭제 등 연산에서 **비일관성**이 생기는 문제

### 이상 현상 종류
1. 삽입 이상
  - 새로운 데이터를 삽입 할 때 **불필요한 데이터도 함께 삽입해야** 하는 문제
2. 갱신 이상
  - 중복된 데이터 중 일부만 변경되어 **데이터 불일치가 발생** 하는 문제
3. 삭제 이상
  - 어떤 데이터르 삭제할 때 **반드시 있어야 하는 정보**까지 같이 사라지는 문제

## 정규화 종류
- 일반적으로 1NF(제 1정규형)에서 시작해, 2NF, 3NF 순으로 진행하며 필요에 따라 BCNF 이상(4NF, 5NF, 6NF) 까지 고려하기도 함
- 3NF 또는 BCNF 까지 도달하면 정규화가 이루어졌다고 표현

### 각 정규화 단계
- 제 1 정규형 (1NF)
  - 각 요소의 **중복되는 항목이 없어야** 한다.

- 제 2 정규형 (2NF)
  - 제 1 정규형을 만족하며서 PK가 아닌 모든 속성이 PK에 **완전 함수 종속되어야**한다.

- 제 3 정규형 (3NF)
  - 제 2 정규형을 만족하면서 모든 속성이 PK에 **이행적 함수 종속이 되지 않아야**한다.

- BCNF (Boyce Codd Normalization Form)
  - 제 3 정규형을 만족하면서 **모든 결정자가 후보키여야**한다.

### 제 1 정규형 (1NF)
1. 각 속성이 원자 값, 즉 하나의 값만 가져야 함
2. 중복된 컬럼이 없어야 함
3. 각 행이 유일하게 식별될 수 있어야 함 (기본키 존재)

### 제 2 정규형 (2NF)
1. 제 1 정규형을 만족해야 함
2. 부분 함수 종속 제거 목적
  - 복합키를 사용하는 테이블에서 모든 비 기본키 속성이 기본키의 모든 컬럼에 완전 종속 되어야 함

### 제 3 정규형 (3NF)
1. 제 2 정규형을 만족해야 함
2. 기본키에 대한 이행적 함수종속이 없어야 함
  - A -> B, B-> C 인 경우,  A -> C 이면 "이행 종속" 이라고 함
  - 기본키가 아닌 속성이 다른 속성(기본키가 아닌)에 의해 결정되지 않아야 함

### BCNF
1. 제 3 정규형을 만족해야 함
2. 모든 결정자가 **후보키**여야 함
3. 3NF 이후에도 남아있는 이상 현상을 해결하는 더 엄격한 형태
4. 기본키가 아닌 속성이 다른 컬럼을 결정할 수 없게끔 테이블을 분해

- 결정자
  - 어떤 속성(또는 속성 집합)이 다른 속성을 결정(함수 종속)할 때, 그 결정자가 곧 후보키가 되어야 한다는 규칙

- 후보키
  - 한 테이블의 각 행을 유일하게 식별할 수 있는 속성 중 최소성을 만족하는 키
  - 후보키의 조건
    - 유일성 : 테이블의 각 행을 고유하게 식별할 수 있어야함
    - 최소성 : 불필요한 컬럼을 포함하지 않는 최소한의 속성 조합이어야함
  - 한 테이블에 여러 후보키가 있으며 그 중 하나를 기본키로 선택해야 함

### 정규화 주의사항
- 3NF 이상으로 들어가면 지나친 분리로 인한 조인(Join) 증가나 성능 저하 등 문제가 발생 할 수 있음
- 업무 요구에 따라 필요한 만큼 정규화/반정규화를 조정할 것을 권장
