# 데이터베이스
## 1. 데이터베이스의 큰 그림
### 데이터베이스와 DBMS
- 데이터베이스 : 원하는 기능을 동작시키기 위해 마땅히 저장해야 하는 정보의 집합
  - 사용자에게 제공되는 프로그램, 특히 웹 서비스에 있어 심장과도 같음
  - 저장되는 데이터에 따라 서비스의 정체성이 달라질 수 있음
  - 저장방식에 따라 성능이 달라질 수 있음
  - DBMS 로 관리

#### DBMS(데이터베이스 관리 시스템)의 종류
1. 관계형 데이터베이스 관리 시스템 (RDBMS) - MySQL, Oracle, MariaDB 등등
2. NoSQL 데이터베이스 관리 시스템 (NoSQL DBMS) - MongoDB, Reids 등등


#### 서버로서의 DBMS
- DBMS는 사용자와 직접적으로 상호작용하기 보다 사용자(개발자)가 만든 프로그램과 상효작용하며 실행됨
- DBMS를 이용하는 과정은 클라이언트 - 서버 간 동작과 유사함
  - DBMS 클라이언트 -> DBMS에 쿼리(Query)를 보냄
<br>

- 이를 위해 DBMS는 데이터베이스를 다루기 위한 언어(데이터베이스 언어)를 제공하고 사용자/응용 프로그램은 DBMS의 데이터베이스 언어를 통해 데이터베이스를 다룰 수 있다.
- 대표적으로 SQL 언어가 있음 (RDBMS에서 데이터를 조작하고 관리하기 위한 언어)

#### SQL
- SQL은 크게 4 종류로 분류함
1. DDL (데이터 정의를 위한 언어)
  - CREATE   - 데이터베이스 or 테이블 or 뷰 or 인덱스 등의 데이터베이스 객체 생성
  - ALTER    - 데이버베이스 객체 갱신
  - DROP     - 데이터베이스 객체 삭제
  - TRUNCATE - 테이블의 구조를 유지한 채 모든 레코드 삭제
2. DML (데이터 조작을 위한 언어)
  - SELECT - 테이블의 레코드 조회
  - INSERT - 테이블에 레코드 삽입
  - UPDATE - 테이블의 레코드 갱신
  - DELETE - 테이블의 레코드 삭제
3. DCL (데이터 제어를 위한 언어)
  - COMMIT    - 트랜잭션이 완료 된 후 변경된 데이터를 데이터베이스에 반영
  - ROLLBACK  - 작업 이전 상태로 되돌림
  - SAVEPOINT - 롤백의 기준점 설정
4. TCL (트랜잭션 제어를 위한 언어)
  - GRANT  - 사용자에게 권한 부여
  - REVOKE - 사용자로부터 권환 회수

### 파일 시스템 대신 데이터베이스를 이용하는 이유
1. 데이터 일관성 및 무결성 보장
2. 데이터의 중복 방지
3. 연관 데이터 변경에 용이함
4. 정교한 검색이 가능함
5. 백업 및 복구가 비교적 수월

### 데이터베이스 저장 단위와 트랜잭션
#### 데이터베이스의 저장 단위
- 데이터베이스에는 다양한 속성을 가진 독립적 객체들이 저장 될 수 있다.
<br>

1. 엔티티(Entity) : 독립적으로 존재할 수 있는 객체
2. 속성(attribute) : 엔티티의 특성

* 도메인(domain) : 엔티티의 속성 값을 가질 수 있는 값의 집합

- 같은 속성을 공유하는 개별 엔티티는 같은 **엔티티 집합**에 속한다 라고 할 수 있다.

* 릴레이션(relation) : RDBMS 에서 표현되는 이차원 테이블 형태의 엔티티 집합
* 컬렉션(collection) : MongoDB 에서의 엔티티 단위
* 엔티디(entity) : 데이터베이스에 저장 가능한 대상
* 레코드(record) : 데이터베이스 상에 저장된 대상
* 필드(field) : 데이터베이스에 저장된 엔티티의 속성


#### 스키마
- RDBMS 와 NoSQL(스키마 리스 데이터베이스)을 구분하는 주요 기준 중 하나가 스키마의 유무
* 스키마(schema) : 데이터베이스에 저장되는 레코드의 구조와 제약 조건의 정의
* NoSQL(스키마 리스 데이터베이스)
  - 스키마를 명시적으로 정의할 필요가 없음


#### 트랜잭션과 ACID
* 트랜잭션 : 데이터베이스와의 논리적 상호작용 단위 (데이터베이스가 처리하는 작업의 단위)
  - 초당트랜잭션(TPS) : 데이터베이스의 작업 성능 지표

- 트랜잭션의 성질 (ACID)
1. 원자성 - 트랜잭션 결과는 모두 성공하거나 모두 실패해야 한다.
2. 일관성 - 트랜잭션 전/후 db는 일관된 상태를 유지한다. (일관성을 깨뜨리지 않는 데이터로만 구성 됨)
3. 격리성 - 동시에 수행되는 트랜잭션 사이 간섭이 없음을 보장한다.
4. 지속성 - 완료된 트랜잭션의 결과는 영구적으로 반영된다.


## 2. RDBMS의 기본
### 테이블 구성 : 필드와 레코드
* 필드 타입 : RDBMS 테이블을 구성할 때 필드에서 사용가능한 데이터의 유형
* 키 : 테이블 내 특정 레코드를 식별할 수 있는 필드의 집합

- 후보키 : 유일성과 최소성을 모두 만족하는 키
  - 후보키 중에서 기본키를 선정한다.
  - 대체키 : 기본키를 선정한 뒤 남은 후보키
- 복합키 : 두 필드 이상으로 구성된 후보키 
- 슈퍼키 : 유일성은 만족하지만 최소성은 만족하지 않는 키
- 기본키 : 여러 후보키 중 테이블의 레코드를 대표하도록 선택된 키 (유일성 & 최소성 만족) NotNull
- 외래키 : 다른 테이블의 기본키를 참조하는 키

#### 일대일 대응 관계
- 테이블의 하나의 레코드가 다른 테이블의 레코드 하나에만 대응하는 경우 (승객 => 여권)

#### 일대다 대응 관계
- 테이블의 하나의 레코드가 다른 테이블의 0개 이상의 레코드와 대응될 수 있는 경우 (고객 => 주문)

#### 다대다 대응 관계
- 한 테이블의 0개 이상의 레코드가 다른 테이블의 0개 이상의 레코드와 대응되는 경우 (SNS)
- 일반적으로 중간 테이블을 수반함

### 무결성 제약 조건
- DB에 저장된 데이터의 일관성과 유효성을 유지하기 위해 지켜야하는 조건
1. 도메인 제약조건
  - 테이블이 가질 수 있는 필드 타입과 범위에 대한 규칙 (제약 조건), 원자값 이어야 함
2. 키 제약 조건
  - 레코드를 고유하게 식별할 수 있는 키로 지정된 필드에 중복값이 존재하면 안된다.
3. 키 무결성 제약 조건(기본키 제약 조건)
  - 기보키로 지정한 필드는 고유한 값이어야 하며 NULL이 존재하면 안된다.
4. 참조 무결성 제약 조건
  - 외래키는 참조하는 테이블의 기본키와 같은 값을 갖거나 NULL값을 가져야 한다.

## 3. SQL
### 데이터 정의어 DDL
#### CREATE
- 데이터베이스 혹은 데이터베이스 객체 생성 명령어

```sql
CREATE TABLE 테이블 이름 (
  필드1_이름 필드1_타입,
  필드2_이름 필드2_타입,
  ...
);
```

#### ALTER
- 데이터베이스 객체 갱신 (필드 및 제약조건을 추가/삭제)

#### DROP
- 데이터베이스 객체 삭제
```sql
DROP DATABASE 데이터베이스이름;
DROP TABLE 테이블이름;
```

#### TRUNCATE
- 테이블의 구조를 유지한 채 모든 레코드를 삭제(빈 테이블로 만들기)
```sql
TRUNCATE TABLE 테이블이름;
```

### 데이터 조작어 DML
#### SELECT 
- 테이블의 레코드 조회
``` sql
SELECT 조회할_필드명 FROM 테이블 
WHERE 그룹화 되기 전 조건식
GROUP BY 그룹화 할 필드
HAVING 그룹화된 결과에 대한 조건
ORDER BY 정렬 할 필드
LIMIT 레코드 개수 제한
```

#### INSERT
- 테이블의 레코드 삽입
```sql
INSERT INTO 테이블 이름 VALUES 값
```

#### UPDATE
- 테이블의 레코드 수정
```sql
UPDATE 테이블 SET 필드 = 값 WHERE 조건
```

#### DELETE
- 테이블의 레코드 삭제
```sql
DELETE 테이블 WHERE 조건
```

### SELECT 문법 실행 순서
- FROM > WHERE > GROUP BY > HAVING > SELECT > ORDER BY > LIMIT

### 트랜잭션 제어어 TCL
#### COMMIT
- 트랜잭션이 완료된 상황을 데이터베이스에 직접 반영

#### ROLLBACK
- 트랜잭션이 실행되기 전 상태로 되돌림

#### SAVEPOINT
- ROLLBACK의 기준점